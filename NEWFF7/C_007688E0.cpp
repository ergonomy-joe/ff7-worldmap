/*
	Final Fantasy VII
	(c) 1997 Square
	decompiled by ergonomy_joe in 2018
*/
//WORLD MAP -- 

#include "ff7.h"

#include "wm_data.h"

////////////////////////////////////////
int D_00E3A8A8;
int D_00E3A8AC;
void *D_00E3A8B0;
int D_00E3A8B4;
int D_00E3A8B8;
int D_00E3A8BC;
char D_00E3A8C0[0x2b];
int D_00E3B0F0;
int D_00E3B0F4;
char D_00E3B0F8[0x2b];
int D_00E3B124;
int D_00E3B128;
int D_00E3B12C;
////////////////////////////////////////
void C_007688E0() {
	int i;

	for(i = 0; i < 0x2b; i ++) {
		D_00E3B0F8[i] = -1;
		D_00E3A8C0[i] = 0;
	}
	D_00E3A8B0 = 0;
	D_00E3A8B8 = 0;
	D_00E3B128 =
	D_00E3A8A8 =
	D_00E3B0F4 = 0;
	D_00E3A8BC = 0;

	D_00E3A8B4 =
	D_00E3A8AC =
	D_00E3B12C = 
	D_00E3B0F0 = 0;

	D_00E3B124 = 0;
}

void C_0076898A() {
	int i;

	if(D_00E3B0F4) {
		D_00E3B0F4 = 0;
		D_00E3B0F0 = 3;
		for(i = 0; i < 0x2b; i ++)
			D_00E3A8C0[i] = 0;
		for(i = 0x20; i < 0x2b; i ++)
			D_00E3B0F8[i] = -1;
	}
}

void C_007689F7() {
	if(D_00E3B0F4 && C_00761176() == 0)
		C_0076898A();
	if(D_00E3B0F0) {
		D_00E3B0F0 --;
		if(D_00E3B0F0 == 0)
			C_00750784();
	}
}

void C_00768B36(short);

struct t_wm_b8 *C_00768A37(short bp08) {
	int local_2;
	int local_1;

	if(bp08 < 0 || bp08 >= 0x2b)
		bp08 = 0;
	if(D_00E3B0F8[bp08] < 0) {//else 00768A8B
		if(bp08 < 3) {
			C_00768B36(bp08);
		} else if(bp08  < 0x20) {
			return 0;
		}
	}
	if(bp08 < 3)
		return D_00E3B128?D_00E2C430:0;
	if(bp08 < 0x20)//else 00768AE4
		return /*local_3*/D_00E3A8A8?&(D_00E2C808[D_00E3B0F8[bp08] - 1]):0;
	if(D_00E3B0F4) {
		local_1 = D_00E3B0F8[bp08] - 0xd;
		if(D_00E3A8C0[bp08] == 0) {
			local_2 = FKMB(int, D_00E3A8B0, 0x10) + local_1 * 0x24;
			D_00E3A8C0[bp08] = 1;
		}

		return 0;
	}

	return 0;
}

void C_00768B82(void);

void C_00768B36(short bp08) {
	if(D_00E3A8AC == 0 && C_007538C9(2)) {
		D_00E3B128 = 0;
		C_00759A65(bp08);//wmfile:load some animations(2)?
		D_00E3A8AC = 1;
	}
	D_00E3B12C = bp08;
	C_00768B82();
}

void C_00768BA9(void);

void C_00768B82() {
	if(D_00E3A8AC) {
		D_00E3A8AC = 0;
		C_0075395E(2);
		C_00768BA9();
	}
}

void C_00768BA9() {
	D_00E3B128 = 1;
	D_00E3B0F8[0] =
	D_00E3B0F8[1] =
	D_00E3B0F8[2] = -1;
	D_00E3B0F8[D_00E3B12C] = 0;
}

void C_00768BF5(void);

void C_00768BE2(short bp08) {
	D_00E3A8B4 = bp08;
	C_00768BF5();
}

char D_0096DF10[][0x20] = {
	{ 0, 0, 0,-1, 1, 2, 3, 9,-1,-1,-1,-1, 5,-1, 8, 6, 7,-1,-1,-1,-1,-1,-1,-1, 4,10,-1,-1,-1,-1,-1,-1},
	{ 0, 0, 0, 3, 1,-1,-1, 9,-1,10,12,-1, 5, 4, 8, 6, 7,-1,-1, 2,-1,-1,-1,-1,11,13,-1,-1,-1,-1,-1,-1},
	{ 0, 0, 0, 3, 1,-1,-1,-1,-1,10,12,-1, 5, 4, 8, 6, 7,-1,-1, 2, 9,-1,-1,-1,11,13,-1,-1,-1,-1,-1,-1},
	{ 0, 0, 0, 3, 1,-1,-1, 9,-1,10,12,-1, 5, 4, 8, 6, 7,-1,-1, 2,-1,-1,-1,-1,11,13,-1,-1,-1,-1,-1,-1},
	{ 0, 0, 0, 3, 1,-1,-1,-1,-1,10,12,-1, 5, 4, 8, 6, 7,-1,-1, 2, 9,-1,-1,-1,11,13,-1,-1,-1,-1,-1,-1},
	{ 0, 0, 0, 3, 1,-1,-1,-1,-1,10,-1,12, 5, 4, 8, 6, 7,-1,-1, 2, 9,-1,-1,-1,11,13,-1,-1,-1,-1,-1,-1},
	{ 0, 0, 0, 3, 1,-1,-1,-1,-1,10,-1,12, 5, 4, 8, 6, 7,-1,-1, 2, 9,-1,-1,-1,11,13,-1,-1,-1,-1,-1,-1},
	{ 0, 0, 0, 3, 1,-1,-1,-1,-1,10,-1,-1, 5, 4, 8, 6, 7,-1,-1, 2, 9,-1,-1,-1,-1,12,-1,-1,-1,11,-1,-1},
	{ 0, 0, 0, 3, 1,-1,-1,-1,-1,10,-1,-1, 5, 4, 8, 6, 7,-1,-1, 2, 9,-1,-1,-1,-1,12,-1,-1,-1,11,-1,-1},
	{ 0, 0, 0,-1,-1,-1,-1, 2, 1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1},
	{ 0, 0, 0,-1,-1,-1,-1, 2, 1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1},
	{ 0, 0, 0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1, 1,-1,-1,-1, 2, 3,-1,-1,-1,-1,-1,-1,-1, 4, 5, 6,-1, 7,-1},
	{ 0, 0, 0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1, 1, 2, 3,-1,-1,-1,-1,-1,-1,-1,-1}
};

void C_00768BF5() {
	int i;

	for(i = 3; i < 0x20; i ++)
		D_00E3B0F8[i] = D_0096DF10[D_00E3A8B4][i];
	D_00E3A8A8 = 1;
}

void C_00768C3D() {
	D_00E3A8AC = 0;
}

void C_00768C4C(int bp08) {
	D_00E3B124 = bp08;
}

int C_00768C59() {
	return D_00E3B124;
}
